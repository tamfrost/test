# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs

name: Node.js CI

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]

jobs:

  check-for-git:
    runs-on: [self-hosted, ubuntu]
    container:
      image: alpine
    steps:
      - uses: actions/checkout@v4
      - name: echo npmrc
        shell: bash
        run: |
             git --version || echo "Git not installed"
             ls -al /github/workspace


  # echo-npmrc:
  #   runs-on: [self-hosted, ubuntu]
  #   container:
  #     image: node:22.13.0
  #   steps:
  #     - name: echo npmrc
  #       shell: bash
  #       run: |
  #            echo ${{ secrets.NPMRC }} > tmp.txt
  #            cat tmp.txt	

  # docker-dind-test:
  #   runs-on: [self-hosted, ubuntu]
  #   container:
  #     image: docker:20.10.16
  #   services:
  #     docker:
  #       image: docker:20.10.16-dind
  #       options: --privileged
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v2
  #     - name: show info
  #       shell: sh
  #       run: |
  #         docker info


  # docker-test:
  #   runs-on: [self-hosted, ubuntu]
  #   container:
  #     image: node:22.13.0
  #   steps:
  #     - name: checkout code
  #       uses: actions/checkout@v4
  #     - name: show versions
  #       shell: bash
  #       run: |
  #         node --version
  #         npm --version

  # build:
  #   runs-on: [self-hosted, ubuntu]
  #   container:
  #     image: node:22.13.0
  #   steps:
  #     - name: checkout code
  #       uses: actions/checkout@v4
  #     - name: build and test
  #       shell: bash
  #       run: |
  #            npm ci
  #            npm run build --if-present
  #            npm test

  # publish:
  #   runs-on: [self-hosted, ubuntu]
  #   environment: production
  #   container:
  #     image: node:22.13.0
  #   steps:
  #     - name: checkout code
  #       uses: actions/checkout@v4
  #     - name: publish
  #       shell: bash
  #       run: |
  #            echo ${{ secrets.NPMRC }} | base64 --decode > ~/.npmrc
  #            cat ~/.npmrc	
  #            npm publish